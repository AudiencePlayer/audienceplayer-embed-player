var e,t,s={d:(e,t)=>{for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},a={};s.d(a,{wc:()=>I,Nm:()=>S,pX:()=>E,hm:()=>n,Q0:()=>i,L9:()=>L,ji:()=>o,cF:()=>C}),(t=e||(e={})).noPlayableAsset="noPlayableAsset",t.notAuthenticated="notAuthenticated",t.needEntitlement="needEntitlement",t.serverError="serverError",t.offlineError="offlineError",t.maxConcurrentStreamNumberError="maxConcurrentStreamNumberError";const i="application/x-mpegURL",n="application/dash+xml",r="video/mp4";function o(e){return e.browser.IS_ANY_SAFARI&&e.browser.IS_IOS||e.browser.IS_SAFARI}function l(e){return e.browser.IS_ANY_SAFARI||e.browser.IS_IOS}var c,h,d,u,p;!function(e){e[e.loading=0]="loading",e[e.playing=1]="playing",e[e.paused=2]="paused",e[e.idle=3]="idle",e[e.buffering=4]="buffering",e[e.error=5]="error"}(c||(c={})),function(e){e.playStart="playStart",e.playing="playing",e.pause="pause",e.error="error",e.stopped="stopped",e.timeupdate="timeupdate",e.textTrackChanged="textTrackChanged",e.audioTrackChanged="audioTrackChanged"}(h||(h={})),function(e){e.chromecast="chromecast",e.default=""}(d||(d={})),function(e){e.play="play",e.playing="playing",e.paused="paused",e.stop="stop",e.error="error",e.configure="configure"}(u||(u={})),function(e){e.live="live",e.archive="archive",e.offline="offline"}(p||(p={}));class y{constructor(e,t){this.playLogs=[],this.apiCallInProgress=!1,this.intervalHandle=null,this.apiUrl=`${e}/service/${t}/analytics/stream/pulse/log`.replace(/\/*$/,"")}init(){null===this.intervalHandle&&(this.intervalHandle=setInterval((()=>{this.processFirstPlayLog()}),3e3))}destroy(){this.intervalHandle&&clearInterval(this.intervalHandle),this.intervalHandle=null}processPlaySession(e,t){if(!e)return;const s=e.eventStack;if(0===s.length)return;const a=[];let i=0,n=0,r=!1;for(;i<s.length;){const e=s[i];if(this.isEventTypeWithoutTimeDelta(e.eventType))a.push(this.convertEventToEventPayload(e)),r=!0;else if(r=!1,i-1>=0){const t=s[i-1];n+=e.timeStamp-t.timeStamp,e.state!==t.state&&(a.push(this.createDeltaEventPayload(t,t.timeStamp,n)),n=0)}i++}const o=s[s.length-1];if((n>0||!r)&&a.push(this.createDeltaEventPayload(o,t,n)),a.length>0){if(a.length>30){const e=a[a.length-1];a.splice(29),e.event_type=u.error,e.event_payload='{"code": 429, "message": "Too many events"}',a.push(e)}let t=this.getPlayerLogPayloadWithPulseToken(e.pulseToken);t||(t={event_stack:[],pulse_token:e.pulseToken,pulse_mode:e.isLive?p.live:p.offline,device_type:e.deviceType},this.playLogs.push(t)),a.forEach((e=>t.event_stack.push(e))),this.processPlayLog(t,e)}}processFirstPlayLog(){this.playLogs.length>0&&this.processPlayLog(this.playLogs[0],null)}processPlayLog(e,t){if(!e||this.apiCallInProgress)return;if(0===e.event_stack.length)return void this.removePlayLog(e);const s={...e,event_stack:[]};let a=0,i=!1;for(;a<e.event_stack.length&&s.event_stack.length<30&&!i;){const t=e.event_stack[a];a++,s.event_stack.push(t),t.event_type===u.stop&&(i=!0)}return s.pulse_mode===p.offline&&s.event_stack.length<30&&!i?void 0:(this.apiCallInProgress=!0,fetch(this.apiUrl,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(s)}).then((()=>!0)).catch((e=>0!==e.status)).then((t=>{t?(e.event_stack.splice(0,a),0===e.event_stack.length&&this.removePlayLog(e)):e.pulse_mode=p.archive,this.apiCallInProgress=!1})))}getPlayerLogPayloadWithPulseToken(e){return this.playLogs.find((t=>t.pulse_token===e))}removePlayLog(e){const t=this.playLogs.findIndex((t=>t.pulse_token===e.pulse_token));t>=0&&this.playLogs.splice(t,1)}isEventTypeWithoutTimeDelta(e){return[h.textTrackChanged,h.audioTrackChanged,h.playStart].indexOf(e)>=0}createBaseEventPayload(e,t){return{timestamp:e.timeStamp,event_type:t,appa:e.playPosition,appr:Math.min(e.playPosition/e.mediaDuration,1),resolution_tag:e.resolution}}convertEventToEventPayload(e){if(e.eventType===h.playStart)return{timestamp:e.timeStamp,event_type:u.play};const t=this.convertEventTypeToEventTypePayload(e),s=this.createBaseEventPayload(e,t);switch(e.eventType){case h.audioTrackChanged:return{...s,audio_locale:e.audioTrack};case h.textTrackChanged:return{...s,subtitle_locale:e.textTrack};default:return s}}createDeltaEventPayload(e,t,s){const a=this.getEventTypePayloadFromEventState(e);return{...this.createBaseEventPayload(e,a),...e.state===c.error?{event_payload:e.error}:{},timestamp:t,time_delta:s/1e3}}getEventTypePayloadFromEventState(e){switch(e.state){case c.playing:return u.playing;case c.paused:return u.paused;case c.error:return u.error;case c.buffering:case c.loading:return u.paused;case c.idle:return u.stop}}convertEventTypeToEventTypePayload(e){switch(e.eventType){case h.playStart:return u.play;case h.audioTrackChanged:case h.textTrackChanged:return u.configure;default:this.getEventTypePayloadFromEventState(e)}}}class m{constructor(e,t){this.intervalHandle=0,this.playerLogProcessor=new y(e,t),this.reset()}init(){this.playerLogProcessor.init()}destroy(){this.playerLogProcessor.destroy()}onStart(e,t,s,a,i){this.reset(),this.playSession={pulseToken:e,deviceType:t,eventStack:[],localTimeDelta:s,isLive:a,onStopCallback:i}}onCurrentTimeUpdated(e){this.playerProperties.playPosition=e,this.playerProperties.mediaDuration>0&&this.playerProperties.state!==c.idle&&this.logEvent(h.timeupdate)}onDurationUpdated(e){this.playerProperties.mediaDuration=e}onPlaying(){this.playerProperties.state!==c.playing&&(this.playerProperties.state===c.idle?(this.playerProperties.state=c.playing,this.logEvent(h.playStart),this.processPlaySession(),this.startInterval()):(this.playerProperties.state=c.playing,this.logEvent(h.playing)))}onPause(){this.playerProperties.state!==c.paused&&this.playerProperties.state!==c.idle&&(this.playerProperties.state=c.paused,this.logEvent(h.pause))}onError(e){this.playerProperties.state!==c.error&&(this.playerProperties.state=c.error,this.playerProperties.error=e,this.logEvent(h.error))}onStop(){this.playerProperties.state!==c.idle&&(this.playerProperties.state=c.idle,this.logEvent(h.stopped),this.stopInterval(),this.processPlaySession())}onTextTrackChanged(e){this.playerProperties.state!==c.idle&&(this.playerProperties.textTrack=e,this.logEvent(h.textTrackChanged))}onAudioTrackChanged(e){this.playerProperties.state!==c.idle&&(this.playerProperties.audioTrack=e,this.logEvent(h.audioTrackChanged))}updateProperties(e){this.playerProperties={...this.playerProperties,...e}}startInterval(){this.stopInterval(),this.intervalHandle=setInterval((()=>{this.processPlaySession()}),3e4)}stopInterval(){this.intervalHandle&&clearInterval(this.intervalHandle)}processPlaySession(){this.playerLogProcessor.processPlaySession({...this.playSession},this.getTimeStamp()),this.playSession.eventStack=[]}logEvent(e){this.playSession&&this.playSession.eventStack.push({...this.playerProperties,eventType:e,timeStamp:this.getTimeStamp()})}reset(){this.playSession=null,this.playerProperties={state:c.idle,error:null,mediaDuration:0,playPosition:0,audioTrack:null,textTrack:null,resolution:null}}getTimeStamp(){return Date.now()-(this.playSession?this.playSession.localTimeDelta:0)}}function g(e,t){const s=e.getComponent("PlayToggle");function a(e,t){const s=e.currentTime(),a=e.liveTracker,i=a&&a.isLive()?a.seekableEnd():e.duration();let n=s+t;n>i?n=i:n<0&&(n=0),e.currentTime(n)}return function(e){switch(e.key){case" ":s.prototype.handleClick.call(this,e);break;case"ArrowLeft":a(this,t.backward);break;case"ArrowRight":a(this,t.forward)}}}function v(e){const t={AFG:"AF",ALA:"AX",ALB:"AL",DZA:"DZ",ASM:"AS",AND:"AD",AGO:"AO",AIA:"AI",ATA:"AQ",ATG:"AG",ARG:"AR",ARM:"AM",ABW:"AW",AUS:"AU",AUT:"AT",AZE:"AZ",BHS:"BS",BHR:"BH",BGD:"BD",BRB:"BB",BLR:"BY",BEL:"BE",BLZ:"BZ",BEN:"BJ",BMU:"BM",BTN:"BT",BOL:"BO",BES:"BQ",BIH:"BA",BWA:"BW",BVT:"BV",BRA:"BR",VGB:"VG",IOT:"IO",BRN:"BN",BGR:"BG",BFA:"BF",BDI:"BI",KHM:"KH",CMR:"CM",CAN:"CA",CPV:"CV",CYM:"KY",CAF:"CF",TCD:"TD",CHL:"CL",CHN:"CN",HKG:"HK",MAC:"MO",CXR:"CX",CCK:"CC",COL:"CO",COM:"KM",COG:"CG",COD:"CD",COK:"CK",CRI:"CR",CIV:"CI",HRV:"HR",CUB:"CU",CUW:"CW",CYP:"CY",CZE:"CZ",DNK:"DK",DJI:"DJ",DMA:"DM",DOM:"DO",ECU:"EC",EGY:"EG",SLV:"SV",GNQ:"GQ",ERI:"ER",EST:"EE",ETH:"ET",FLK:"FK",FRO:"FO",FJI:"FJ",FIN:"FI",FRA:"FR",GUF:"GF",PYF:"PF",ATF:"TF",GAB:"GA",GMB:"GM",GEO:"GE",DEU:"DE",GHA:"GH",GIB:"GI",GRC:"GR",GRL:"GL",GRD:"GD",GLP:"GP",GUM:"GU",GTM:"GT",GGY:"GG",GIN:"GN",GNB:"GW",GUY:"GY",HTI:"HT",HMD:"HM",VAT:"VA",HND:"HN",HUN:"HU",ISL:"IS",IND:"IN",IDN:"ID",IRN:"IR",IRQ:"IQ",IRL:"IE",IMN:"IM",ISR:"IL",ITA:"IT",JAM:"JM",JPN:"JP",JEY:"JE",JOR:"JO",KAZ:"KZ",KEN:"KE",KIR:"KI",PRK:"KP",KOR:"KR",KWT:"KW",KGZ:"KG",LAO:"LA",LVA:"LV",LBN:"LB",LSO:"LS",LBR:"LR",LBY:"LY",LIE:"LI",LTU:"LT",LUX:"LU",MKD:"MK",MDG:"MG",MWI:"MW",MYS:"MY",MDV:"MV",MLI:"ML",MLT:"MT",MHL:"MH",MTQ:"MQ",MRT:"MR",MUS:"MU",MYT:"YT",MEX:"MX",FSM:"FM",MDA:"MD",MCO:"MC",MNG:"MN",MNE:"ME",MSR:"MS",MAR:"MA",MOZ:"MZ",MMR:"MM",NAM:"NA",NRU:"NR",NPL:"NP",NLD:"NL",ANT:"AN",NCL:"NC",NZL:"NZ",NIC:"NI",NER:"NE",NGA:"NG",NIU:"NU",NFK:"NF",MNP:"MP",NOR:"NO",OMN:"OM",PAK:"PK",PLW:"PW",PSE:"PS",PAN:"PA",PNG:"PG",PRY:"PY",PER:"PE",PHL:"PH",PCN:"PN",POL:"PL",PRT:"PT",PRI:"PR",QAT:"QA",REU:"RE",ROU:"RO",RUS:"RU",RWA:"RW",BLM:"BL",SHN:"SH",KNA:"KN",LCA:"LC",MAF:"MF",SPM:"PM",VCT:"VC",WSM:"WS",SMR:"SM",STP:"ST",SAU:"SA",SEN:"SN",SRB:"RS",SYC:"SC",SLE:"SL",SGP:"SG",SXM:"SX",SVK:"SK",SVN:"SI",SLB:"SB",SOM:"SO",ZAF:"ZA",SGS:"GS",SSD:"SS",ESP:"ES",LKA:"LK",SDN:"SD",SUR:"SR",SJM:"SJ",SWZ:"SZ",SWE:"SE",CHE:"CH",SYR:"SY",TWN:"TW",TJK:"TJ",TZA:"TZ",THA:"TH",TLS:"TL",TGO:"TG",TKL:"TK",TON:"TO",TTO:"TT",TUN:"TN",TUR:"TR",TKM:"TM",TCA:"TC",TUV:"TV",UGA:"UG",UKR:"UA",ARE:"AE",GBR:"GB",USA:"US",UMI:"UM",URY:"UY",UZB:"UZ",VUT:"VU",VEN:"VE",VNM:"VN",VIR:"VI",WLF:"WF",ESH:"EH",YEM:"YE",ZMB:"ZM",ZWE:"ZW",XKX:"XK"};return e&&3===e.length?t[e=e.toUpperCase()]?t[e].toLowerCase():e.substr(0,2).toLowerCase():(""+e).toLowerCase()}function f(e){const t=e&&3===e.length?v(e):e,s={ab:"аҧсуа",aa:"Afaraf",af:"Afrikaans",ak:"Akan",sq:"Shqip",am:"አማርኛ",ar:"العربية",an:"Aragonés",hy:"Հայերեն",as:"অসমীয়া",av:"авар мацӀ, магӀарул мацӀ",ae:"avesta",ay:"aymar aru",az:"azərbaycan dili",bm:"bamanankan",ba:"башҡорт теле",eu:"euskara, euskera",be:"Беларуская",bn:"বাংলা",bh:"भोजपुरी",bi:"Bislama",bs:"bosanski jezik",br:"brezhoneg",bg:"български език",my:"ဗမာစာ",ca:"Català",ch:"Chamoru",ce:"нохчийн мотт",ny:"chiCheŵa, chinyanja",zh:"中文 (Zhōngwén), 汉语, 漢語",cv:"чӑваш чӗлхи",kw:"Kernewek",co:"corsu, lingua corsa",cr:"ᓀᐦᐃᔭᐍᐏᐣ",hr:"hrvatski",cs:"čeština",da:"dansk",dv:"ދިވެހި",nl:"Nederlands",en:"English",eo:"Esperanto",et:"eesti",ee:"Eʋegbe",fo:"føroyskt",fj:"vosa Vakaviti",fi:"suomi",fr:"français",ff:"Fulfulde, Pulaar, Pular",gl:"Galego",ka:"ქართული",de:"Deutsch",el:"Ελληνικά",gn:"Avañeẽ",gu:"ગુજરાતી",ht:"Kreyòl ayisyen",ha:"Hausa, هَوُسَ",he:"עברית",hz:"Otjiherero",hi:"हिन्दी, हिंदी",ho:"Hiri Motu",hu:"Magyar",ia:"Interlingua",id:"Bahasa Indonesia",ie:"Interlingue",ga:"Gaeilge",ig:"Asụsụ Igbo",ik:"Iñupiaq",io:"Ido",is:"Íslenska",it:"Italiano",iu:"ᐃᓄᒃᑎᑐᑦ",ja:"日本語",jv:"basa Jawa",kl:"kalaallisut, kalaallit oqaasii",kn:"ಕನ್ನಡ",kr:"Kanuri",ks:"कश्मीरी, كشميري‎",kk:"Қазақ тілі",km:"ភាសាខ្មែរ",ki:"Gĩkũyũ",rw:"Ikinyarwanda",ky:"кыргыз тили",kv:"коми кыв",kg:"KiKongo",ko:"한국어 (韓國語), 조선말 (朝鮮語)",ku:"كوردی‎",kj:"Kuanyama",la:"latine",lb:"Lëtzebuergesch",lg:"Luganda",li:"Limburgs",ln:"Lingála",lo:"ພາສາລາວ",lt:"lietuvių kalba",lu:"Luba-Katanga",lv:"latviešu valoda",gv:"Gaelg, Gailck",mk:"македонски јазик",mg:"Malagasy fiteny",ms:"bahasa Melayu, بهاس ملايو‎",ml:"മലയാളം",mt:"Malti",mi:"te reo Māori",mr:"मराठी",mh:"Kajin M̧ajeļ",mn:"монгол",na:"Ekakairũ Naoero",nv:"Diné bizaad, Dinékʼehǰí",nb:"Norsk bokmål",nd:"isiNdebele",ne:"नेपाली",ng:"Owambo",nn:"Norsk nynorsk",no:"Norsk",ii:"ꆈꌠ꒿ Nuosuhxop",nr:"isiNdebele",oc:"Occitan",oj:"ᐊᓂᔑᓈᐯᒧᐎᓐ",cu:"ѩзыкъ словѣньскъ",om:"Afaan Oromoo",or:"ଓଡ଼ିଆ",os:"ирон æвзаг",pa:"ਪੰਜਾਬੀ, پنجابی‎",pi:"पाऴि",fa:"فارسی",pl:"polski",ps:"پښتو",pt:"Português",qu:"Runa Simi, Kichwa",rm:"rumantsch grischun",rn:"kiRundi",ro:"română",ru:"русский",sa:"संस्कृतम्",sc:"sardu",sd:"सिन्धी, سنڌي، سندھی‎",se:"Davvisámegiella",sm:"gagana faa Samoa",sg:"yângâ tî sängö",sr:"српски језик",gd:"Gàidhlig",sn:"chiShona",si:"සිංහල",sk:"slovenčina",sl:"slovenščina",so:"Soomaaliga, af Soomaali",st:"Sesotho",es:"español",su:"Basa Sunda",sw:"Kiswahili",ss:"SiSwati",sv:"svenska",ta:"தமிழ்",te:"తెలుగు",tg:"تاجیکی‎",th:"ไทย",ti:"ትግርኛ",bo:"བོད་ཡིག",tk:"Türkmen",tl:"Wikang Tagalog",tn:"Setswana",to:"faka Tonga",tr:"Türkçe",ts:"Xitsonga",tt:"تاتارچا‎",tw:"Twi",ty:"Reo Tahiti",ug:"ئۇيغۇرچە‎",uk:"українська",ur:"اردو",uz:"zbek, Ўзбек, أۇزبېك‎",ve:"Tshivenḓa",vi:"Tiếng Việt",vo:"Volapük",wa:"Walon",cy:"Cymraeg",wo:"Wollof",fy:"Frysk",xh:"isiXhosa",yi:"ייִדיש",yo:"Yorùbá",za:"Saɯ cueŋƅ, Saw cuengh",mis:"uncoded languages",mul:"multiple languages",und:"undetermined",zxx:"no linguistic content/not applicable"};return t&&s[t]?s[t]:t}function T(e,t,s,a){return fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...a?{Authorization:"Bearer "+a}:{}},body:JSON.stringify({query:t,variables:s})}).then((e=>e.json()))}function k(e){return{type:e.type,url:e.url,baseUrl:e.base_url,fileName:e.file_name}}function C(e){switch(e){case i:case n:case r:return e;case"application/vnd.apple.mpegurl":return i;default:return console.warn(`Unknown mime-type ${e}, defaulting to mp4`),r}}class P{constructor(e,t){this.apiFetchUrl=`${e}/graphql/${t}/user`,this.token=null}setToken(e){this.token=e}getArticle(e){return T(this.apiFetchUrl,"\n    query Article($articleId: Int!) {\n        Article(id: $articleId) {\n            id\n            name\n            metas {\n                key\n                value\n            }\n            assets {\n                id\n                duration\n                linked_type\n                accessibility\n            }\n            posters {\n                type\n                url\n                title\n                base_url\n                file_name\n            }\n            images {\n                type\n                url\n                title\n                base_url\n                file_name\n            }\n        }\n    }\n",{articleId:e},this.token).then((e=>{if(!e||!e.data||e.errors){const{message:t,code:s}=e.errors[0];throw{message:t,code:s}}return{name:(t=e.data.Article).name,metas:(s=t.metas,s.reduce(((e,t)=>({...e,[t.key]:t.value})),{})),posters:t.posters.map(k),images:t.images.map(k)};var t,s}))}getArticleAssetPlayConfig(e,t=null,s=!0){return T(this.apiFetchUrl,"\n    mutation ArticleAssetPlay($articleId: Int, $assetId: Int, $protocols: [ArticlePlayProtocolEnum]) {\n        ArticleAssetPlay(article_id: $articleId, asset_id: $assetId, protocols: $protocols) {\n            article_id\n            asset_id\n            entitlements {\n                mime_type\n                protocol\n                manifest\n                is_live\n                token\n                encryption_type\n                key_delivery_url\n                encryption_provider\n                hls_key_uri\n                media_provider\n            }\n            subtitles {\n                url\n                locale\n                locale_label\n            }\n            pulse_token\n            appa\n            appr\n            fairplay_certificate_url\n            user_subtitle_locale\n            user_audio_locale\n            aspect_ratio\n            issued_at\n            time_marker_end\n            time_marker_intro_start\n            time_marker_intro_end\n        }\n    }\n",{articleId:e.articleId,assetId:e.assetId,protocols:["dash","hls"],device_model_context:t},this.token).then((t=>{if(!t||!t.data||t.errors){const{message:e,code:s}=t.errors[0];throw{message:e,code:s}}return console.log("response",t.data.ArticleAssetPlay),function(e,t,s=!0){const a=Date.parse(e.issued_at),i=[];(s&&e.entitlements.find((e=>"fps"===e.encryption_type))?e.entitlements.filter((e=>"aes"!==e.encryption_type)):e.entitlements).forEach((t=>{const a={src:t.manifest,type:C(t.mime_type),isLive:t.is_live,protectionInfo:null,mediaProvider:t.media_provider};if(t.encryption_type)if("cenc"===t.encryption_type&&0===t.protocol.indexOf("dash")){if(!s)return;a.protectionInfo=[{type:"Widevine",authenticationToken:"azl"===t.encryption_provider&&t.token?"Bearer "+t.token:"",keyDeliveryUrl:t.key_delivery_url,encryptionProvider:t.encryption_provider}]}else if("fps"===t.encryption_type&&0===t.protocol.indexOf("hls")){if(!s)return;a.protectionInfo=[{type:"FairPlay",authenticationToken:"azl"===t.encryption_provider&&t.token?"Bearer "+t.token:"",certificateUrl:e.fairplay_certificate_url,keyDeliveryUrl:t.key_delivery_url,encryptionProvider:t.encryption_provider,contentKeyId:"azl"===t.encryption_provider?t.key_delivery_url.replace("https://","skd://"):t.hls_key_uri}]}i.push(a)}));const n=e.subtitles.map((e=>({src:e.url,srclang:e.locale,kind:"subtitles",label:e.locale_label}))),r=t.continueFromPreviousPosition&&e.appa<e.time_marker_end?e.appa:0,o=e.time_marker_intro_end>0&&e.time_marker_intro_end>e.time_marker_intro_start?{skipIntro:{start:e.time_marker_intro_start,end:e.time_marker_intro_end}}:{};return{entitlements:i,subtitles:n,pulseToken:e.pulse_token,currentTime:r,continuePaused:t.continuePaused,articleId:e.article_id,assetId:e.asset_id,subtitleLocale:e.user_subtitle_locale,audioLocale:e.user_audio_locale,localTimeDelta:isNaN(a)?0:Date.now()-a,aspectRatio:e.aspect_ratio.replace("x",":"),...o}}(t.data.ArticleAssetPlay,e,s)}))}}class S{constructor(e){if(this.chromecastReceiverAppId=e,this.castContext=null,this.castPlayer=null,this.castPlayerController=null,this.lastConnectionInfo=null,this.lastPlayStateInfo=null,this.updateInterval=null,this.supportsHDR=!1,this.playConfig=null,this.onConnectedListeners=[],this.onPlayStateListeners=[],this.onCurrentTimeListeners=[],this.onMediaTracksListeners=[],this.onDurationListeners=[],this.onApiErrorListeners=[],S.initPromise)throw Error("ChromecastSender already initialized");S.initPromise=new Promise(((e,t)=>{if(this.chromecastReceiverAppId){window.__onGCastApiAvailable=s=>{if(s&&cast&&cast.framework&&chrome&&chrome.cast)try{this.initializeCastApi(this.chromecastReceiverAppId),this.dispatchConnectionInfo({available:!0,connected:!1,friendlyName:""}),e()}catch(e){this.dispatchConnectionInfo({available:!1,connected:!1,friendlyName:""}),t(e)}else this.dispatchConnectionInfo({available:!1,connected:!1,friendlyName:""}),t("Chromecast not available")};const s=document.createElement("script");s.async=!0,s.src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",document.head.appendChild(s)}else this.dispatchConnectionInfo({available:!1,connected:!1,friendlyName:""}),t("Chromecast Receiver Application Id is missing")}))}init(){return S.initPromise}initializeCastApi(e){cast.framework.CastContext.getInstance().setOptions({receiverApplicationId:e,autoJoinPolicy:chrome.cast.AutoJoinPolicy.TAB_AND_ORIGIN_SCOPED}),this.castContext=cast.framework.CastContext.getInstance(),this.castPlayer=new cast.framework.RemotePlayer,this.castPlayerController=new cast.framework.RemotePlayerController(this.castPlayer),this.castPlayerController.addEventListener(cast.framework.RemotePlayerEventType.IS_CONNECTED_CHANGED,(e=>{if(this.castPlayer.isConnected){const e=this.getCastSession();e&&e.addMessageListener("urn:x-cast:com.audienceplayer.messagebus",((e,t)=>{const s=JSON.parse(t);if("boolean"==typeof s.is_hdr_supported)this.supportsHDR=s&&s.is_hdr_supported;else if("object"==typeof s.error&&s.error.code){const e={code:s.error.code,message:s.error.message};this.onApiErrorListeners.forEach((t=>{t(e,s.playParams)}))}else"object"==typeof s.playConfig&&(this.playConfig=s.playConfig)}))}else this.supportsHDR=!1})),this.castPlayerController.addEventListener(cast.framework.RemotePlayerEventType.IS_CONNECTED_CHANGED,(e=>{if(this.castPlayer.isConnected){const e=this.getCastSession();if(e){const t=e.getCastDevice();if(t)return void this.dispatchConnectionInfo({available:!0,connected:!0,friendlyName:t.friendlyName||"Chromecast"})}}this.castPlayer.isConnected||null===this.lastPlayStateInfo||(this.lastPlayStateInfo=null,this.dispatchPlayState(null,null)),this.dispatchConnectionInfo({available:!0,connected:!1,friendlyName:""})})),this.castPlayerController.addEventListener(cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED,(()=>{const e=this.castPlayer.playerState;let t=null;if(this.castPlayer.isMediaLoaded){if(this.castPlayer.mediaInfo&&null!==e&&e!==chrome.cast.media.PlayerState.IDLE){const e=this.castPlayer.mediaInfo.customData;if(e)if(e.extraInfo){const s=JSON.parse(e.extraInfo);s.articleId&&s.assetId&&(t={articleId:s.articleId,assetId:s.assetId},e.token&&(t.token=e.token))}else e.articleId&&e.assetId&&(t={articleId:e.articleId,assetId:e.assetId,token:e.token})}this.dispatchPlayState(e,t)}})),this.castPlayerController.addEventListener(cast.framework.RemotePlayerEventType.DURATION_CHANGED,(()=>{this.castPlayer.isMediaLoaded&&this.onDurationListeners.forEach((e=>e(this.castPlayer.duration)))})),this.castPlayerController.addEventListener(cast.framework.RemotePlayerEventType.MEDIA_INFO_CHANGED,(()=>{if(this.castPlayer.isMediaLoaded&&this.castPlayer.mediaInfo){const e=this.getCastMediaSession();let t=[],s=[];this.castPlayer.mediaInfo.tracks&&e&&(t=this.getTracksByType("AUDIO"),s=this.getTracksByType("TEXT"),this.onMediaTracksListeners.forEach((e=>e(t,s))))}}))}addOnConnectedListener(e){this.onConnectedListeners.push(e),this.lastConnectionInfo&&this.dispatchConnectionInfo(this.lastConnectionInfo)}removeOnConnectedListener(e){const t=this.onConnectedListeners.indexOf(e);t>=0&&this.onConnectedListeners.splice(t,1)}addOnPlayStateListener(e){this.onPlayStateListeners.push(e),null!==this.lastPlayStateInfo&&this.dispatchPlayState(this.lastPlayStateInfo.state,this.lastPlayStateInfo.info)}removeOnPlayStateListener(e){const t=this.onPlayStateListeners.indexOf(e);t>=0&&this.onPlayStateListeners.splice(t,1)}addOnCurrentTimeListener(e){0===this.onCurrentTimeListeners.length&&(this.updateInterval=setInterval((()=>{const e=this.getCastMediaSession();e&&this.onCurrentTimeListeners.forEach((t=>t(e.getEstimatedTime())))}),500)),this.onCurrentTimeListeners.push(e)}removeOnCurrentTimeListener(e){const t=this.onCurrentTimeListeners.indexOf(e);t>=0&&this.onCurrentTimeListeners.splice(t,1),0===this.onCurrentTimeListeners.length&&clearInterval(this.updateInterval)}addOnMediaTracksListener(e){this.onMediaTracksListeners.push(e)}removeOnMediaTracksListener(e){const t=this.onMediaTracksListeners.indexOf(e);t>=0&&this.onMediaTracksListeners.splice(t,1)}addOnDurationListener(e){this.onDurationListeners.push(e)}removeOnDurationListener(e){const t=this.onDurationListeners.indexOf(e);t>=0&&this.onDurationListeners.splice(t,1)}addOnApiErrorListener(e){this.onApiErrorListeners.push(e)}removeOnApiErrorListener(e){const t=this.onApiErrorListeners.indexOf(e);t>=0&&this.onApiErrorListeners.splice(t,1)}getSupportsHDR(){return this.supportsHDR}getPlayConfig(){return this.playConfig}getCastMediaInfo(e,t){if(e&&e.entitlements&&e.entitlements.length>0){let s=null;const a=["application/x-mpegURL","application/vnd.apple.mpegurl","video/mp4"],i=e.entitlements.find((e=>!!a.includes(e.type)&&(s=e.type,!0))),n="application/vnd.apple.mpegurl"===s?[]:e.subtitles.map(((e,t)=>{const s=t+1,a=new chrome.cast.media.Track(s,chrome.cast.media.TrackType.TEXT);return a.trackContentId=e.src,a.trackContentType="text/vtt",a.subtype=chrome.cast.media.TextTrackType.SUBTITLES,a.name=e.label,a.language=e.srclang,a.customData=null,a}));if(i){const a=new chrome.cast.media.MediaInfo(i.src,s);a.streamType=i.isLive?chrome.cast.media.StreamType.LIVE:chrome.cast.media.StreamType.BUFFERED,this.addMediaInfoToMetaData(t,a),n.length>0&&(a.tracks=n);const r=e.audioLocale?{preferredAudioLocale:e.audioLocale}:{},o=e.subtitleLocale?{preferredTextLocale:e.subtitleLocale}:{};return a.customData={...r,...o,entitlements:e.entitlements,pulseToken:e.pulseToken,mediaProvider:i.mediaProvider,articleId:e.articleId,assetId:e.assetId},a.currentTime=e.currentTime,a}}return null}getCastMediaInfoByParams(e){const t=new chrome.cast.media.MediaInfo("contentIdPlaceHolder","application/vnd.cast-media");return t.contentId="asset-"+e.assetId+"-"+Math.random(),e.article&&this.addMediaInfoToMetaData(e.article,t),t.customData={...e},t}getCastSession(){return this.castContext?this.castContext.getCurrentSession():null}getCastMediaSession(){const e=this.getCastSession();if(e)return e.getMediaSession()}castVideo(e,t,s){if(this.isConnected()){const a=this.getCastSession(),i=this.getCastMediaInfo(e,t);if(i){this.playConfig=null;const t=new chrome.cast.media.LoadRequest(i);return t.currentTime=s?e.currentTime:0,a.loadMedia(t)}throw{message:"Unexpected manifest format in articlePlayConfig "+JSON.stringify(e)}}}castVideoByParams(e){return new Promise(((t,s)=>{if(this.isConnected()){const a=this.getCastSession(),i=this.getCastMediaInfoByParams(e);if(i){this.playConfig=null;const e=new chrome.cast.media.LoadRequest(i);a.loadMedia(e).then((e=>{t()}))}else s("Could not create media info request")}else s("castVideoByParams: Not connected!")}))}isConnected(){return this.castPlayer&&this.castPlayer.isConnected}stopMedia(){return new Promise(((e,t)=>{if(this.castContext){const t=this.getCastSession();if(t){const s=t.getMediaSession();if(s)return void s.stop(new chrome.cast.media.StopRequest,(()=>{e()}),(()=>{console.log("stopMedia: dit NOT stop media session"),e()}))}}console.log("stopMedia: No session"),e()}))}endSession(e){if(this.castContext){const t=this.getCastSession();t&&t.endSession(e)}}stopCasting(){this.endSession(!0)}getCastPlayer(){return this.castPlayer}getCastPlayerController(){return this.castPlayerController}addMediaInfoToMetaData(e,t){if(e){t.metadata=new chrome.cast.media.GenericMediaMetadata,t.metadata.metadataType=chrome.cast.media.MetadataType.GENERIC,t.metadata.title=function(e){return((t=e.metas)["title"]?t.title:"")||e.name;var t}(e);const s=e.images&&e.images.length?e.images[0]:null;t.metadata.images=s?[new chrome.cast.Image(`${s.baseUrl}/1920x1080/${s.fileName}`)]:[]}}getActiveTracksByType(e){return this.getTracksByType(e).filter((e=>e.active)).map((e=>+e.id))}getTracksByType(e){const t=this.getCastMediaSession();return this.castPlayer.mediaInfo.tracks.filter((t=>t.type===e&&t.language)).map((e=>({id:e.trackId,locale:e.language,active:t&&t.activeTrackIds&&-1!==t.activeTrackIds.indexOf(e.trackId)})))}setActiveTracks(e,t){if(this.castPlayer&&this.castPlayer.isConnected){const t=this.getCastMediaSession();if(t){const s=new chrome.cast.media.EditTracksInfoRequest(e);t.editTracksInfo(s,(()=>{}),(t=>console.error("ChromecastSender.setActiveTracks",e,t)))}else console.error("setActiveTracks called but no media session")}}setActiveTrackById(e,t){const s=this.getActiveTracksByType("AUDIO"===t?"TEXT":"AUDIO"),a=this.getActiveTracksByType(t).indexOf(e);("AUDIO"===t||"TEXT"===t&&-1===a)&&s.push(e),this.setActiveTracks(s,t)}dispatchConnectionInfo(e){this.lastConnectionInfo=e,this.onConnectedListeners.forEach((t=>t(e)))}dispatchPlayState(e,t){this.lastPlayStateInfo={state:e,info:t},this.onPlayStateListeners.forEach((s=>s(e,t)))}}S.initPromise=null;class L{constructor(e,t=null,s=0,a=null){this.videojsInstance=e,this.player=null,this.apiService=null,this.castSender=null,this.stopped=!1,this.continueTimeout=null,this.onConnectedListener=e=>{if(!this.player)return;const t=this.player.controlBar.getChild("fullscreenToggle");e.connected?(this.player.addClass("vjs-chromecast-connected"),t&&t.hide()):(this.player.removeClass("vjs-chromecast-connected"),t&&t.show()),e.connected&&"application/vnd.chromecast"!==this.player.currentType()&&this.continueWithCurrentSources()},this.onPlayStateListener=(e,t)=>{null===e||e===chrome.cast.media.PlayerState.IDLE?(this.player.removeClass("vjs-chromecast-has-media"),"application/vnd.chromecast"===this.player.currentType()&&setTimeout((()=>{this.castSender&&!this.castSender.isConnected()&&this.continueWithCurrentSources()}),300)):this.player.addClass("vjs-chromecast-has-media")},t&&"string"==typeof t&&s>0&&(this.apiService=new P(t.replace(/\/*$/,""),s)),this.playerLoggerService=new m(t,s),function(e){const t=e.getComponent("audioTrackButton"),s=e.getComponent("audioTrackMenuItem");class a extends s{constructor(e,t){const s=t.track,a=e.audioTracks();t.label=f(s.language||s.label)||"Unknown",t.selected=s.enabled,super(e,t),this.track=s,this.addClass(`vjs-${s.kind}-menu-item`);const i=(...e)=>{this.handleTracksChange.apply(this,e)};a.addEventListener("change",i),this.on("dispose",(()=>{a.removeEventListener("change",i)}))}createEl(e,t,s){const a=super.createEl(e,t,s),i=a.querySelector(".vjs-menu-item-text");return"main-desc"===this.options_.track.kind&&(i.appendChild(super.createEl("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),i.appendChild(super.createEl("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),a}handleClick(e){if(super.handleClick(e),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks){const e=this.player_.audioTracks();for(let t=0;t<e.length;t++){const s=e[t];s!==this.track&&(s.enabled=s===this.track)}}}handleTracksChange(e){this.selected(this.track.enabled)}}e.registerComponent("customAudioTrackButton",class extends t{constructor(e,t){super(e)}createItems(e=[]){this.hideThreshold_=1;const t=this.player_.audioTracks();for(let s=0;s<t.length;s++){const i=t[s];e.push(new a(this.player_,{track:i,selectable:!0,multiSelectable:!1}))}return e}})}(e),function(e){const t=e.getComponent("component"),s=document.createElement("google-cast-launcher");s.className="vjs-chromecast-button",e.registerComponent("chromecastButton",class extends t{constructor(e,t){super(e,t)}createEl(){const e=super.createEl();return e.appendChild(s),e}})}(e),function(e){const t=e.getComponent("Component");e.registerComponent("customOverlay",class extends t{createEl(){return this.options_.element}})}(e),function(e){const t=e.getComponent("Component"),s=e.dom||e;e.registerComponent("overlay",class extends t{createEl(){const e=s.createEl("div",{className:"vjs-overlay"});return this.options_.element&&e.appendChild(this.options_.element),e}updateContent(e){this.el_.innerHTML="",this.el_.appendChild(e)}})}(e),function(e){const t=e.getComponent("playbackRateMenuButton");e.registerComponent("customPlaybackRateMenuButton",class extends t{constructor(e,t){super(e)}createEl(){const e=super.createEl();return e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="vjs-playback-rate-svg">\n            <path d="M0 0h24v24H0z" fill="none"/>\n            <path class="vjs-custom-svg-color" d="M20.38 8.57l-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 15.58 6.85l1.85-1.23A10 10 0 0 0 3.35 19a2 2 0 0 0 1.72 1h13.85a2 2 0 0 0 1.74-1 10 10 0 0 0-.27-10.44zm-9.79 6.84a2 2 0 0 0 2.83 0l5.66-8.49-8.49 5.66a2 2 0 0 0 0 2.83z"/></svg>',e}})}(e),function(e){const t=e.getComponent("ClickableComponent");e.dom,e.registerComponent("skipIntro",class extends t{constructor(e,t){super(e,t);let s=0,a=!1,i=!1,n=!1,r=!1;const o=()=>{n||(n=!0,this.removeClass("vjs-skip-intro-button--hidden"))},l=()=>{n&&(n=!1,this.addClass("vjs-skip-intro-button--hidden"))},c=()=>{i=!0,a&&o()},h=()=>{i=!1,0===s&&l()},d=()=>{a=!0,r||(r=!0,o(),clearTimeout(s),s=setTimeout((function(){l(),s=0}),1e4))},u=()=>{a=!1,r=!1,l()};e.on("useractive",c),e.on("userinactive",h),this.on("show",d),this.on("hide",u),this.on("dispose",(function(){this.off("show",d),this.off("hide",u),e.off("useractive",c),e.off("userinactive",h)}))}createEl(){const e=super.createEl("div",{className:"vjs-skip-intro-button vjs-skip-intro-button--hidden"}),t=document.createElement("span");return t.className="vjs-skip-intro-button-text",t.innerText=this.options_.label||"Skip",e.appendChild(t),e}handleClick(e){this.trigger("skip")}})}(e),function(e){const t=e.getComponent("textTrackButton"),s=e.getComponent("menuItem"),a=e.getComponent("offTextTrackMenuItem");class i extends s{constructor(e,t){const s=t.track,a=e.textTracks();t.label=f(s.language||s.label)||"Unknown",t.selected="showing"===s.mode,super(e,t),this.track=s,this.kinds=(t.kinds||[t.kind||this.track.kind]).filter(Boolean);const i=(...e)=>{this.handleTracksChange.apply(this,e)},n=(...e)=>{this.handleSelectedLanguageChange.apply(this,e)};if(e.on(["loadstart","texttrackchange"],i),a.addEventListener("change",i),a.addEventListener("selectedlanguagechange",n),this.on("dispose",(function(){e.off(["loadstart","texttrackchange"],i),a.removeEventListener("change",i),a.removeEventListener("selectedlanguagechange",n)})),void 0===a.onchange){let e;this.on(["tap","click"],(function(){if("object"!=typeof window.Event)try{e=new window.Event("change")}catch(e){}e||(e=document.createEvent("Event"),e.initEvent("change",!0,!0)),a.dispatchEvent(e)}))}this.handleTracksChange()}handleClick(e){const t=this.track,s=this.player_.textTracks();if(super.handleClick(e),s)for(let e=0;e<s.length;e++){const a=s[e];-1!==this.kinds.indexOf(a.kind)&&(a===t?"showing"!==a.mode&&(a.mode="showing"):"disabled"!==a.mode&&(a.mode="disabled"))}}handleTracksChange(e){const t="showing"===this.track.mode;t!==this.isSelected_&&this.selected(t)}handleSelectedLanguageChange(e){if("showing"===this.track.mode){const e=this.player_.cache_.selectedLanguage;if(e&&e.enabled&&e.language===this.track.language&&e.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}}dispose(){this.track=null,super.dispose()}}class n extends t{constructor(e,t={}){t.tracks=e.textTracks(),super(e,t)}createItems(e=[],t=i){let s;this.label_&&(s=`${this.label_} off`),e.push(new a(this.player_,{kinds:this.kinds_,kind:this.kind_,label:s})),this.hideThreshold_+=1;const n=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(let s=0;s<n.length;s++){const a=n[s];if(this.kinds_.indexOf(a.kind)>-1){const s=new t(this.player_,{track:a,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});s.addClass(`vjs-${a.kind}-menu-item`),e.push(s)}}return e}}class r extends n{constructor(e,t,s){super(e,t),this.setIcon("subtitles")}buildCSSClass(){return`vjs-subtitles-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subtitles-button ${super.buildWrapperCSSClass()}`}}r.prototype.kind_="subtitles",e.registerComponent("customTextTrackButton",n),e.registerComponent("customSubtitlesButton",r)}(e),a&&(this.castSender=new S(a),function(e,t){const s=e.getComponent("Tech");e.dom,e.registerTech("chromecast",class extends s{constructor(s){super(s),this.myPlayerController=null,this.myPlayer=null,this.lastCurrentTime=0,this.didEnd=!1,this.featuresVolumeControl=!1,this.featuresMuteControl=!1,this.featuresFullscreenResize=!1,this.onPlayStateListener=(e,t)=>{if(this.source)e===chrome.cast.media.PlayerState.PLAYING?(this.trigger("play"),this.trigger("playing")):e===chrome.cast.media.PlayerState.PAUSED?this.trigger("pause"):e===chrome.cast.media.PlayerState.BUFFERING&&this.trigger("waiting");else{if(e===chrome.cast.media.PlayerState.IDLE||null===e)return;this.source={src:"restore",type:"application/vnd.chromecast",playParams:{...t}},this.didEnd=!1,this.triggerSourceset(this.source),this.trigger("loadstart"),this.trigger("play"),this.trigger("playing"),null===this.myPlayer.playerState||this.myPlayer.playerState===chrome.cast.media.PlayerState.BUFFERING?this.trigger("waiting"):this.myPlayer.playerState!==chrome.cast.media.PlayerState.PLAYING&&(this.trigger("pause"),setTimeout((()=>{this.trigger("timeupdate")}),300)),this.trigger("timeupdate")}},this.onCurrentTimeListener=e=>{this.lastCurrentTime=e,this.duration()>0&&e+1>this.duration()&&!this.didEnd&&(this.didEnd=!0,this.trigger("ended")),this.trigger("timeupdate")},this.onDurationListener=e=>{this.trigger("durationchange")},this.onMediaTracksListener=(t,s)=>{Array.from(this.audioTracks()).forEach((e=>this.audioTracks().removeTrack(e))),t.forEach((t=>{const s=new e.AudioTrack({id:t.id,kind:"main",label:f(t.locale),language:t.locale,enabled:t.active});this.audioTracks().addTrack(s)})),Array.from(this.textTracks()).forEach((e=>this.textTracks().removeTrack(e))),s.forEach((t=>{const s=new e.TextTrack({tech:this,id:t.id,label:f(t.locale),kind:"subtitles",language:t.locale,mode:t.active?"showing":"disabled"});this.textTracks().addTrack(s)}))},t.init().then((()=>{this.myPlayer=t.getCastPlayer(),this.myPlayerController=t.getCastPlayerController(),t.addOnPlayStateListener(this.onPlayStateListener),t.addOnCurrentTimeListener(this.onCurrentTimeListener),t.addOnDurationListener(this.onDurationListener),t.addOnMediaTracksListener(this.onMediaTracksListener),this.textTracks().addEventListener("change",(()=>this.handleTextTrackChange())),this.audioTracks().addEventListener("change",(()=>this.handleAudioTrackChange())),this.triggerReady()}))}static canPlaySource(e){return!!e&&t&&t.isConnected()}static isSupported(){return!0}static canPlayType(e){return"application/vnd.chromecast"===e?"probably":""}createEl(t,s,a){return this.el_=e.dom.createEl("div",{className:"vjs-tech chromecast"}),this.el_}play(){this.myPlayerController&&this.myPlayer&&this.myPlayer.isConnected&&(this.ended()?(this.setCurrentTime(0),this.myPlayerController.playOrPause()):this.paused()&&this.myPlayerController.playOrPause())}pause(){this.myPlayerController&&this.myPlayer&&this.myPlayer.isConnected&&!this.paused()&&this.myPlayer.canPause&&this.myPlayerController.playOrPause()}paused(){return this.myPlayer&&this.myPlayer.isPaused||this.ended()||this.myPlayer&&null===this.myPlayer.playerState}setSource(e){this.source=e,this.didEnd=!1,this.source&&(this.source&&"restore"===this.source.src?this.trigger("loadstart"):(this.trigger("loadstart"),t.castVideoByParams(e.playParams).then((()=>{this.trigger("waiting")})).catch((e=>console.log(e)))))}currentSrc(){return this.source&&this.source.src||""}setCurrentTime(e){if(this.myPlayerController&&this.myPlayer&&this.myPlayer.isConnected&&this.myPlayer.canSeek){const t=this.duration();if(e>t)return;this.myPlayer.currentTime=Math.min(t-1,Math.floor(e)),this.myPlayerController.seek()}else console.log("Can not seek")}currentTime(){return this.lastCurrentTime}duration(){return this.myPlayer?0===this.myPlayer.duration?NaN:this.myPlayer.duration:NaN}ended(){return this.didEnd}buffered(){}seekable(){const t=this.duration();return t>0?e.time.createTimeRanges(0,t):e.time.createTimeRanges()}handleTextTrackChange(){if(this.myPlayer&&this.myPlayer.isConnected){const e=Array.from(this.textTracks()).find((e=>"showing"===e.mode));e&&t.setActiveTrackById(e.id,"TEXT")}}handleAudioTrackChange(){if(this.myPlayer&&this.myPlayer.isConnected){const e=Array.from(this.audioTracks()).find((e=>e.enabled));e&&t.setActiveTrackById(e.id,"AUDIO")}}controls(){return!1}playsinline(){return!0}supportsFullScreen(){return!1}setAutoplay(){}playbackRate(){return 1}setPlaybackRate(){}preload(){}load(){}readyState(){return!this.myPlayer||this.myPlayer&&null===this.myPlayer.playerState||this.myPlayer&&this.myPlayer.playerState===chrome.cast.media.PlayerState.IDLE||this.myPlayer&&this.myPlayer.playerState===chrome.cast.media.PlayerState.BUFFERING?0:4}volume(){return 1}setVolume(e){}muted(){return!1}setMuted(e){}dispose(){t.removeOnPlayStateListener(this.onPlayStateListener),t.removeOnCurrentTimeListener(this.onCurrentTimeListener),t.removeOnDurationListener(this.onDurationListener),t.removeOnMediaTracksListener(this.onMediaTracksListener),this.textTracks().removeEventListener("change"),this.audioTracks().removeEventListener("change"),this.myPlayerController=null,this.myPlayer=null,this.source=null,this.didEnd=!1,this.lastCurrentTime=0,super.dispose()}})}(e,this.castSender))}init(e){this.destroy(),this.stopped=!1,this.localPlayConfig=null,this.initParams=e;const t=e.selector instanceof Element?e.selector:document.querySelector(e.selector);if(!t)throw Error("Invalid selector or element for player");this.playerLoggerService.init();const s=document.createElement("video");s.setAttribute("class",["video-js",e.defaultSkinClass?e.defaultSkinClass:"vjs-default-skin"].join(" ")),s.setAttribute("tabIndex","0"),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.disableRemotePlayback=!o(this.videojsInstance),t.appendChild(s);const a={fluid:!1,fill:!0,responsive:!0,techOrder:this.castSender?["chromecast","html5"]:["html5"],controls:!0,controlBar:{pictureInPictureToggle:!1,skipButtons:e.skipButtons||!1,currentTimeDisplay:!0,durationDisplay:!0,timeDivider:!1,volumePanel:{inline:!1},chromecastButton:!!e.chromecastButton,children:["skipBackward","playToggle","skipForward","currentTimeDisplay","progressControl","durationDisplay",{name:"spacer"},"customPlaybackRateMenuButton","customSubtitlesButton","customAudioTrackButton","volumePanel","chromecastButton","fullscreenToggle"]},userActions:{hotkeys:g(this.videojsInstance,{backward:-30,forward:30})},html5:{vhs:{overrideNative:!o(this.videojsInstance),cacheEncryptionKeys:!0}},...e.options};this.player=this.videojsInstance(s,a),this.player.eme(),this.player.eme.initLegacyFairplay(),this.bindEvents()}playByParams(e){return this.stopped=!1,this.castSender&&this.castSender.isConnected()?(this.localPlayConfig=null,this.player.src({src:"chromecast",type:"application/vnd.chromecast",playParams:e}),Promise.resolve()):this.apiService?(this.player.addClass("vjs-waiting"),this.apiService.setToken(e.token?e.token:null),this.apiService.getArticleAssetPlayConfig(e).then((t=>{this.stopped?this.player.removeClass("vjs-waiting"):this.player.src(this.getAndInitPlaySourcesFromConfig(t,e))})).catch((e=>{throw this.player.removeClass("vjs-waiting"),e}))):Promise.reject("No API service available")}play(e){this.stopped=!1,this.castSender&&this.castSender.isConnected()?console.error("video-player: play() is not supported when chromecast is connected"):(this.player.src(this.getAndInitPlaySourcesFromConfig(e)),this.initParams.fullscreen&&this.player.requestFullscreen())}setPoster(e){this.player.poster(e)}updateOverlay(e){const t=this.player.overlay;t&&t.updateContent(e)}destroy(){this.stop(),this.playerLoggerService.destroy(),this.castSender&&(this.castSender.removeOnConnectedListener(this.onConnectedListener),this.castSender.removeOnPlayStateListener(this.onPlayStateListener)),this.player&&this.player.dispose(),this.player=null,this.currentAudioTrack=null,this.currentTextTrack=null,this.currentTime=-1}getPlayer(){return this.player}stop(){this.stopped||(this.stopped=!0,this.firstPlayingEvent=!0,this.continueTimeout&&(clearTimeout(this.continueTimeout),this.continueTimeout=null),this.player&&(!1===this.player.ended()&&(this.player.pause(),this.localPlayConfig&&this.playerLoggerService.onStop()),this.player.removeClass("vjs-waiting"),this.player.reset()))}isStopped(){return this.stopped}getAndInitPlaySourcesFromConfig(e,t=null){this.localPlayConfig=e,this.playerLoggerService.onStart(e.pulseToken,d.default,e.localTimeDelta,!0);const s=l(this.videojsInstance),a=!s,o=e.entitlements.filter((e=>e.type===i&&(s||null===e.protectionInfo))),c=e.entitlements.filter((e=>e.type===n&&(a||null===e.protectionInfo))),h=e.entitlements.filter((e=>e.type===r)),u=(l(this.videojsInstance)||0===c.length&&0===h.length)&&o.length>0,p=u?{}:{textTracks:e.subtitles.map((t=>({kind:t.kind,src:t.src,srclang:t.srclang,label:t.label,enabled:t.srclang===e.subtitleLocale})))};return e.entitlements.map((e=>{const s=function(e,t){let s=null,a={};if(t.protectionInfo)switch(t.type){case n:s=t.protectionInfo.find((e=>"Widevine"===e.type)),s&&(a={keySystems:{"com.widevine.alpha":s.keyDeliveryUrl},emeHeaders:"azl"===s.encryptionProvider?{Authorization:s.authenticationToken}:{}});break;case i:s=t.protectionInfo.find((e=>"FairPlay"===e.type)),s&&(a="azl"===s.encryptionProvider?{keySystems:{"com.apple.fps.1_0":{certificateUri:s.certificateUrl,getContentId:function(){return function(e){let t=document.createElement("a");return t.href=e,t.hostname}(s.keyDeliveryUrl)},getLicense:function(t,a,i,n){const r="spc="+function(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=[];for(let a=0;a<e.byteLength;){let i=e[a++];s.push(t.charAt(i>>2)),i=(3&i)<<4,a<e.byteLength?(s.push(t.charAt(i|e[a]>>4)),i=(15&e[a++])<<2,a<e.byteLength?(s.push(t.charAt(i|e[a]>>6)),s.push(t.charAt(63&e[a++]))):(s.push(t.charAt(i)),s.push("="))):(s.push(t.charAt(i)),s.push("=="))}return s.join("")}(i)+"&assetId="+encodeURIComponent(a);e.xhr({uri:s.keyDeliveryUrl,method:"post",headers:{"Content-type":"application/x-www-form-urlencoded",Authorization:s.authenticationToken},body:r,responseType:"arraybuffer"},e.xhr.httpHandler((function(e,t){n(null,function(e){let t=String.fromCharCode.apply(null,new Uint8Array(e)).trim(),s=t.indexOf("<ckc>"),a=t.indexOf("</ckc>");if(-1===s||-1===a)throw Error("License data format not as expected, missing or misplaced <ckc> tag");return s+=5,t=t.substr(s,a-s),function(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=new Uint8Array(new ArrayBuffer(3*e.length/4+4)),a=0;for(let i=0;i<e.length;){let n=t.indexOf(e.charAt(i)),r=t.indexOf(e.charAt(i+1));if(s[a++]=n<<2|r>>4,"="!==e.charAt(i+2)){let n=t.indexOf(e.charAt(i+2));if(s[a++]=r<<4|n>>2,"="!==e.charAt(i+3)){let r=t.indexOf(e.charAt(i+3));s[a++]=n<<6|r}}i+=4}return new Uint8Array(s.buffer,0,a)}(t)}(t))}),!0))}}}}:{keySystems:{"com.apple.fps.1_0":{certificateUri:s.certificateUrl,getContentId:function(){return s.contentKeyId.replace("skd://","").replace(";","")},getLicense:function(t,a,i,n){const r=i;e.xhr({uri:s.keyDeliveryUrl,method:"post",headers:{"Content-type":"application/octet-stream"},body:r,responseType:"arraybuffer"},e.xhr.httpHandler((function(e,t){console.log("err",e,t),n(null,t)}),!0))}}},emeHeaders:{}})}return a}(this.videojsInstance,e);return{src:e.src,type:e.type,playParams:t,...s,...p}})).filter((e=>e.type===i&&u||!u))}bindEvents(){this.castSender&&(this.castSender.addOnConnectedListener(this.onConnectedListener),this.castSender.addOnPlayStateListener(this.onPlayStateListener)),this.player.on("error",(()=>{this.localPlayConfig&&this.playerLoggerService.onError(JSON.stringify(this.player.error()))})),this.player.on("playing",(()=>{this.localPlayConfig&&(this.firstPlayingEvent&&(this.firstPlayingEvent=!1,this.localPlayConfig&&this.localPlayConfig.currentTime>0&&this.player.currentTime(this.localPlayConfig.currentTime),this.localPlayConfig&&this.localPlayConfig.continuePaused&&this.player.pause()),this.checkSelectedTracks(),this.playerLoggerService.onPlaying())})),this.player.on("pause",(()=>{this.localPlayConfig&&(this.checkSelectedTracks(),this.player.paused()&&!this.player.ended()&&this.localPlayConfig&&this.playerLoggerService.onPause())})),this.player.on("ended",(()=>{this.localPlayConfig&&(this.checkSelectedTracks(),this.localPlayConfig&&this.playerLoggerService.onStop())}));const e=this.player.skipIntro;this.player.on("timeupdate",(()=>{const t=Math.ceil(this.player.currentTime())||0;if(this.currentTime!==t){this.currentTime=t,this.localPlayConfig&&(this.checkSelectedTracks(),this.playerLoggerService.onCurrentTimeUpdated(this.currentTime));const s=this.getSkipIntroConfig();s&&e&&(s.start<=this.currentTime&&s.end>=this.currentTime?e.trigger("show"):e.trigger("hide"))}})),e&&e.on("skip",(()=>{const e=this.getSkipIntroConfig();e&&this.player.currentTime(e.end)})),this.player.on("durationchange",(()=>{this.localPlayConfig&&(this.checkSelectedTracks(),this.playerLoggerService.onDurationUpdated(this.player.duration()))})),this.player.on("loadedmetadata",(()=>{if(this.localPlayConfig){(this.player.currentSource().textTracks||[]).forEach((e=>{this.player.addRemoteTextTrack(e,!1)}));const e=this.player.audioTracks();e&&e.length>0?(this.setDefaultAudioTrack(),this.setDefaultTextTrack(),this.metadataLoaded=!0):setTimeout((()=>{this.setDefaultAudioTrack(),this.setDefaultTextTrack(),this.metadataLoaded=!0}),1e3)}}))}getCastSender(){return this.castSender}checkSelectedTracks(){if(!this.metadataLoaded)return!1;let e="",t="",s=null;const a=this.player.videoWidth(),i=this.player.videoHeight();a>0&&i>0&&(s=a+"x"+i);const n=this.player.textTracks();for(let e=0;e<n.length;e++)"showing"===n[e].mode&&"subtitles"===n[e].kind&&(t=n[e].language);const r=this.player.audioTracks();for(let t=0;t<r.length;t++)if(r[t].enabled){e=r[t].language;break}this.localPlayConfig&&this.playerLoggerService.updateProperties({textTrack:t,audioTrack:e,resolution:s}),null!==this.currentTextTrack&&this.currentTextTrack!==t&&this.localPlayConfig&&this.playerLoggerService.onTextTrackChanged(t),this.currentTextTrack=t,null!==this.currentAudioTrack&&this.currentAudioTrack!==e&&this.localPlayConfig&&this.playerLoggerService.onAudioTrackChanged(e),this.currentAudioTrack=e}setDefaultTextTrack(){if(this.localPlayConfig&&this.localPlayConfig.subtitleLocale){const e=this.player.textTracks();for(let t=0;t<e.length;t++)"disabled"!==e[t].mode&&(e[t].mode="disabled");for(let t=0;t<e.length;t++)if(v(e[t].language)===this.localPlayConfig.subtitleLocale.toLowerCase()&&"subtitles"===e[t].kind){e[t].mode="showing";break}}}setDefaultAudioTrack(){if(this.localPlayConfig&&this.localPlayConfig.audioLocale){const e=this.player.audioTracks();for(let t=0;t<e.length;t++){const s=v(e[t].language);if(this.localPlayConfig.audioLocale&&s===this.localPlayConfig.audioLocale.toLowerCase()||""===this.localPlayConfig.audioLocale&&0===t){e[t].enabled=!0;break}}}}continueWithCurrentSources(){const e=this.player.currentSources(),t=this.player.paused();!this.stopped&&e&&e.length>0&&e[0].playParams&&this.player.currentType()&&(this.stop(),this.player.addClass("vjs-waiting"),this.continueTimeout=setTimeout((()=>{this.continueTimeout=null,this.playByParams({...e[0].playParams,continuePaused:t})}),3e3))}getSkipIntroConfig(){if(this.localPlayConfig)return this.localPlayConfig.skipIntro;if(this.castSender){const e=this.castSender.getPlayConfig();if(e&&e.skipIntro)return e.skipIntro}return null}}class E{constructor(e,t){this.projectId=t.projectId,this.apiBaseUrl=t.apiBaseUrl.replace(/\/*$/,""),this.apiService=new P(this.apiBaseUrl,this.projectId),this.videoPlayer=new L(e,this.apiBaseUrl,this.projectId,t.chromecastReceiverAppId),this.castSender=this.videoPlayer.getCastSender()}initVideoPlayer(e){this.videoPlayer.init(e)}setVideoPlayerPoster(e){this.videoPlayer.setPoster(e)}setVideoPlayerPosterFromArticle(e,t){return this.apiService.getArticle(e).then((e=>{this.videoPlayer.setPoster(function(e,t){if(e){const{width:s,height:a}=t;return`${e.baseUrl}/${s}x${a}/${e.fileName}`}return""}(function(e){return e.posters.length>0?e.posters[0]:this.article.length>0?e.images[0]:null}(e),t))}))}play(e){return e.articleId?e.assetId?this.videoPlayer.playByParams(e):Promise.reject("assetId property is missing"):Promise.reject("articleId property is missing")}destroy(){this.videoPlayer.destroy()}playVideo(e){this.videoPlayer.play(e)}getVideoPlayer(){return this.videoPlayer.getPlayer()}appendChromecastButton(e){const t=e instanceof Element?e:document.querySelector(e),s=document.createElement("google-cast-launcher");t.appendChild(s)}castVideo(e){return e.articleId?e.assetId?(this.apiService.setToken(e.token),this.apiService.getArticle(e.articleId).then((t=>(e.article=t,this.castSender.castVideoByParams(e))))):Promise.reject("assetId property is missing"):Promise.reject("articleId property is missing")}getCastSender(){return this.castSender}getCastPlayer(){return this.castSender.getCastPlayer()}getCastPlayerController(){return this.castSender.getCastPlayerController()}isConnected(){return this.castSender.isConnected()}endSession(e){this.castSender.endSession(e)}}class I{constructor(e,t){this.castSender=e,this.player=this.castSender.getCastPlayer(),this.playerController=this.castSender.getCastPlayerController(),this.totalDuration=this.player.duration||0,this.currentTime=this.player.currentTime||0,this.currentStatus=this.player.playerState,this.createChromecastControlsTemplate(t),this.bindEvents(),this.setPlayButtonClass(),this.bindEventsToControls(),this.setProgressBarValues()}bindEvents(){this.castSender.addOnMediaTracksListener(((e,t)=>{this.rootElement&&this.player.mediaInfo&&this.renderTracks(e,t)})),this.castSender.addOnCurrentTimeListener((e=>{this.rootElement&&(this.currentTime=e,this.totalDuration=this.player.duration,this.setProgressBarValues())})),this.castSender.addOnPlayStateListener((e=>{this.rootElement&&(this.currentStatus=e,this.checkChromecastContainerVisibility(),this.setPlayButtonClass(),this.setProgressBarValues())})),this.checkChromecastContainerVisibility()}createChromecastControlsTemplate(e){const t=e?e instanceof HTMLElement?e:document.querySelector(e):document.body;t.insertAdjacentHTML("beforeend",'\n        <div class="chromecast-controls video-js vjs-workinghover">\n            <div class="vjs-control-bar">\n\n                <button class="play-pause-button vjs-play-control vjs-control vjs-button vjs-paused" type="button" title="Play" aria-disabled="false">\n                    <span class="vjs-icon-placeholder" aria-hidden="true"></span><span class="vjs-control-text" aria-live="polite">Play</span>\n                </button>\n\n               <div class="chromecast-controls__progress-bar">\n                 <div class="chromecast-controls__progress-bar__current vjs-time-control"></div>\n                 <div class="chromecast-controls__progress-bar-slider-container">\n                    <input type="range"\n                        value="0"\n                        class="chromecast-controls__progress-bar__slider"\n                        min="0"\n                        max="100"/>\n                    <div class="chromecast-controls__progress-bar__slider-left"></div>\n                </div>\n                 <div class="chromecast-controls__progress-bar__total vjs-time-control"></div>\n               </div>\n\n                <div class="vjs-subtitles-button vjs-menu-button vjs-menu-button-popup vjs-control vjs-button">\n                    <button class="vjs-subtitles-button vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-disabled="false" aria-haspopup="true" aria-expanded="false">\n                        <span class="vjs-icon-placeholder" aria-hidden="true"></span>\n                        <span class="vjs-control-text" aria-live="polite"></span>\n                    </button>\n                    <div class="vjs-menu"></div>\n                </div>\n\n                <div class="vjs-audio-button vjs-menu-button vjs-menu-button-popup vjs-control vjs-button">\n                    <button class="vjs-audio-button vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-disabled="false" title="Audio Track" aria-haspopup="true" aria-expanded="false">\n                        <span class="vjs-icon-placeholder" aria-hidden="true"></span>\n                        <span class="vjs-control-text" aria-live="polite">Audio Track</span>\n                    </button>\n                    <div class="vjs-menu"></div>\n                </div>\n\n                <div class="vjs-control vjs-button vjs-chromecast-button">\n                    <google-cast-launcher></google-cast-launcher>\n                </div>\n           </div>\n        </div>\n        '),this.rootElement=t.querySelector(".chromecast-controls")}setPlayButtonClass(){const e=this.getElement(".play-pause-button");this.currentStatus===chrome.cast.media.PlayerState.PAUSED?e.classList.replace("vjs-playing","vjs-paused"):e.classList.replace("vjs-paused","vjs-playing")}bindEventsToControls(){this.getElement(".play-pause-button").addEventListener("click",(()=>this.playPause())),this.bindEventsToMenu(".vjs-subtitles-button"),this.bindEventsToMenu(".vjs-audio-button"),this.getElement(".chromecast-controls__progress-bar__slider").addEventListener("input",(e=>{this.seek(e.target.value)}))}bindEventsToMenu(e){const t=this.getElement(`div${e}`),s=this.getElement(`button${e}`),a=this.getElement(`${e} .vjs-menu`);s.addEventListener("click",(e=>{e.defaultPrevented||this.toggleMenu(a,t)})),s.addEventListener("mouseenter",(()=>{t.classList.add("vjs-hover")})),t.addEventListener("mouseleave",(()=>{t.classList.remove("vjs-hover")})),a.addEventListener("blur",(()=>{this.toggleMenu(a,t)}))}renderTracks(e,t){const s=cast.framework.CastContext.getInstance().getCurrentSession().getMediaSession();s&&s.media&&(s.media.streamType===chrome.cast.media.StreamType.LIVE?this.rootElement.classList.add("vjs-live"):this.rootElement.classList.remove("vjs-live"));const a=this.getElement(".vjs-subtitles-button.vjs-menu-button-popup");t.length>0?a.classList.remove("vjs-hidden"):a.classList.add("vjs-hidden");const i=this.getElement(".vjs-audio-button.vjs-menu-button-popup");e.length>0?i.classList.remove("vjs-hidden"):i.classList.add("vjs-hidden");const n=this.getElement(".vjs-audio-button .vjs-menu"),r=this.getElement(".vjs-subtitles-button .vjs-menu");n.innerHTML="",e.length>0&&n.appendChild(this.getTracksList(e,"AUDIO")),r.innerHTML="",t.length>0&&r.appendChild(this.getTracksList(t,"TEXT"))}getTracksList(e,t){const s=document.createElement("ul");return s.classList.add("vjs-menu-content"),s.addEventListener("click",(e=>this.setActiveTrack(e,"AUDIO"===t?"AUDIO":"TEXT"))),e.forEach((e=>{const t=document.createElement("li");t.classList.add("vjs-menu-item"),e.active?t.classList.add("vjs-selected"):t.classList.remove("vjs-selected"),t.innerText=f(e.locale),t.value=e.id,s.appendChild(t)})),s}getTransformedDurationValue(e){const t=Math.floor(e/3600),s=Math.floor((e-3600*t)/60),a=Math.round(e-3600*t-60*s);let i="";return e||0!==e?(t>0&&(i=t+":",s<10&&(i+="0")),i+=s+":",a<10&&(i+="0"),i+a):"-"}setProgressBarValues(){if(this.rootElement){const e=this.getElement(".chromecast-controls__progress-bar__current"),t=this.getElement(".chromecast-controls__progress-bar__total"),s=this.getElement(".chromecast-controls__progress-bar__slider"),a=this.getElement(".chromecast-controls__progress-bar__slider-left");e.innerText=this.getTransformedDurationValue(this.currentTime),t.innerText=this.getTransformedDurationValue(this.totalDuration),s.max=this.totalDuration,s.value=this.currentTime,a.style.width=s.offsetWidth*this.currentTime/this.totalDuration+"px"}}checkChromecastContainerVisibility(){this.currentStatus===chrome.cast.media.PlayerState.IDLE?this.rootElement.classList.add("chromecast-controls--idle"):this.rootElement.classList.remove("chromecast-controls--idle")}playPause(){this.player&&this.player.isConnected&&this.playerController.playOrPause()}seek(e){this.player&&this.player.isConnected&&(this.player.currentTime=e,this.playerController.seek())}stop(){this.player&&this.player.isConnected&&this.playerController.stop()}setActiveTrack(e,t){if(e.target instanceof HTMLLIElement&&"LI"===e.target.nodeName){e.preventDefault(),e.stopPropagation();const s=+e.target.value,a=this.castSender.getActiveTracksByType("AUDIO"===t?"TEXT":"AUDIO"),i=this.castSender.getActiveTracksByType(t).indexOf(s);("AUDIO"===t||"TEXT"===t&&-1===i)&&a.push(s),this.castSender.setActiveTracks(a,t)}}toggleMenu(e,t){e.classList.contains("vjs-lock-showing")||t.classList.contains("vjs-hover")?(e.classList.remove("vjs-lock-showing"),e.removeAttribute("tabindex"),t.classList.remove("vjs-hover")):(e.classList.add("vjs-lock-showing"),e.setAttribute("tabindex","-1"),e.focus())}getElement(e){return this.rootElement.querySelector(e)}}var b=a.wc,A=a.Nm,_=a.pX,M=a.hm,w=a.Q0,N=a.L9,j=a.ji,D=a.cF;export{b as ChromecastControls,A as ChromecastSender,_ as EmbedPlayer,M as MimeTypeDash,w as MimeTypeHls,N as VideoPlayer,j as supportsNativeHLS,D as toMimeType};
//# sourceMappingURL=bundle.js.map